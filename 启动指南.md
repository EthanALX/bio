# Visual Bio 项目启动指南

## 前置要求

- Python 3.9+ ✅ (当前: Python 3.14.2)
- Miniconda/Conda ✅ (用于 Python 环境管理)
- Node.js 18+ ✅ (当前: v18.16.0)
- pnpm ✅ (已安装)

## 启动步骤

### 1. 启动后端（FastAPI）

```bash
# 进入后端目录
cd backend

# 创建 conda 虚拟环境（推荐使用 miniconda）
conda create -n bio-backend python=3.9 -y
conda activate bio-backend

# 安装依赖
pip install -r requirements.txt

# 创建环境配置文件（如果不存在）
cp .env.example .env

# 运行数据库迁移
alembic upgrade head

# 启动后端服务器（默认端口 8000）
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# 如果 8000 端口被占用，可以使用其他端口（例如 8001）
# uvicorn main:app --reload --host 0.0.0.0 --port 8001
```

**注意**：
- 如果环境已存在，只需激活：`conda activate bio-backend`
- 如果使用其他端口（如 8001），记得更新前端的 `.env.local` 配置（见下方说明）

后端启动后访问（根据实际端口调整）：
- API 文档: http://localhost:8000/docs
- 健康检查: http://localhost:8000/health

### 2. 启动前端（Next.js）

**打开新的终端窗口**，然后：

```bash
# 进入前端目录
cd frontend

# 安装依赖
pnpm install

# 创建环境配置文件
cp .env.local.example .env.local

# 编辑 .env.local，确保 API_URL 指向后端
# 如果后端使用默认端口 8000：
# NEXT_PUBLIC_API_URL=http://localhost:8000
# 如果后端使用其他端口（如 8001），修改为：
# NEXT_PUBLIC_API_URL=http://localhost:8001

# 启动前端开发服务器（端口 3000）
pnpm dev
```

前端启动后访问：
- 应用地址: http://localhost:3000

## 快速启动（一键脚本）

你也可以使用以下命令快速启动：

### 后端启动脚本（使用 conda）
```bash
cd backend
conda create -n bio-backend python=3.9 -y && conda activate bio-backend && pip install -r requirements.txt && cp .env.example .env && alembic upgrade head && uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

**或者如果环境已存在**：
```bash
cd backend
conda activate bio-backend && pip install -r requirements.txt && cp .env.example .env && alembic upgrade head && uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### 前端启动脚本
```bash
cd frontend
pnpm install && cp .env.local.example .env.local && pnpm dev
```

## 注意事项

1. **端口配置**：
   - 后端默认运行在 `8000` 端口
   - 前端默认运行在 `3000` 端口
   - 确保前端的 `.env.local` 中 `NEXT_PUBLIC_API_URL=http://localhost:8000`

2. **数据库**：
   - 开发环境使用 SQLite（`visual_bio.db`）
   - 首次启动会自动创建数据库文件
   - 需要先运行 `alembic upgrade head` 创建表结构

3. **CORS 配置**：
   - 后端已配置允许 `http://localhost:3000` 和 `http://localhost:5173` 的跨域请求

## 验证安装

### 检查后端
```bash
curl http://localhost:8000/health
```

应该返回：
```json
{
  "status": "healthy",
  "version": "1.0.0",
  "database": "connected"
}
```

### 检查前端
打开浏览器访问 http://localhost:3000，应该能看到活动仪表板界面。

## 常见问题

1. **端口被占用**：
   - **方法 1**：使用其他端口启动后端
     ```bash
     # 使用 8001 端口（或其他可用端口）
     uvicorn main:app --reload --host 0.0.0.0 --port 8001
     ```
     然后更新前端的 `.env.local`：
     ```bash
     NEXT_PUBLIC_API_URL=http://localhost:8001
     ```
   
   - **方法 2**：关闭占用端口的进程
     ```bash
     # 查找占用 8000 端口的进程
     lsof -i :8000
     # 杀死进程（替换 <PID> 为实际进程ID）
     kill -9 <PID>
     # 或一行命令
     kill -9 $(lsof -ti :8000)
     ```
2. **数据库错误**：确保运行了 `alembic upgrade head`
3. **依赖安装失败**：检查 Python/Node.js 版本是否符合要求
4. **API 连接失败**：检查 `.env.local` 中的 `NEXT_PUBLIC_API_URL` 配置
5. **conda 环境问题**：
   - 如果环境已存在，直接使用 `conda activate bio-backend`
   - 查看所有环境：`conda env list`
   - 删除环境：`conda env remove -n bio-backend`
